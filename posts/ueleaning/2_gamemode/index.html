<!DOCTYPE html>
<html lang="en-us">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <title>
    GameMode游戏模式 | 
    
    GeeTeng</title>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="description" content="课程笔记及作业
    ">


<meta property="og:url" content="http://localhost:1313/posts/ueleaning/2_gamemode/">
  <meta property="og:site_name" content="GeeTeng">
  <meta property="og:title" content="GameMode游戏模式">
  <meta property="og:description" content="课程笔记及作业">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-11-23T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-11-23T00:00:00+00:00">
    <meta property="article:tag" content="UE5">


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="GameMode游戏模式">
  <meta name="twitter:description" content="课程笔记及作业">


  <meta itemprop="name" content="GameMode游戏模式">
  <meta itemprop="description" content="课程笔记及作业">
  <meta itemprop="datePublished" content="2024-11-23T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-11-23T00:00:00+00:00">
  <meta itemprop="wordCount" content="1142">
  <meta itemprop="keywords" content="UE5">
<link rel="canonical" href="http://localhost:1313/posts/ueleaning/2_gamemode/" />

<link rel="icon" type="image/png" href="http://localhost:1313/image/favicon.ico">

<link rel="stylesheet" href="/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/bulma.min.css">

<link rel="stylesheet" href="https://cdn.jsdmirror.com/npm/katex@0.16.11/dist/katex.min.css" />
<script defer src="https://cdn.jsdmirror.com/npm/katex@0.16.11/dist/katex.min.js" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdmirror.com/npm/katex@0.16.11/dist/contrib/auto-render.min.js" crossorigin="anonymous"
  onload="renderMathInElement(document.body, {
          delimiters: [
            { left: '$$', right: '$$', display: true },
            { left: '$', right: '$', display: false }
          ],
          throwOnError: false
        });"></script>


<script src=/js/ramium.js></script>
<link rel="stylesheet" href=/css/ramium.css>


<link rel="stylesheet" href=/css/chordsheet.css>



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"
    integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"
    integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz"
    crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"
    integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>



</head>

<body>
    
     
    <style type="text/css">
        .fireworks {
            position: fixed;
            pointer-events: none;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
        }
        #particles-js {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;    
            height: 100vh;   
            z-index: -1;     
        }
    </style>
    <canvas class="fireworks"></canvas>
<script src="/js/anime.min.js"></script>
<script src="/js/fireworks.js"></script>


    <script type="text/javascript">
        fireworks.setCanvasSize();
    </script>
    <nav class="navbar is-dark" role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a class="navbar-item" href=/>
      
      <strong>GeeTeng </strong>
      
    </a>

    <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false"
      data-target="navbarBasicExample">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>

  <div id="navbarBasicExample" class="navbar-menu">
    <div class="navbar-start">
      
      
      <a class="navbar-item" href="/">Home</a>
      
      
      
      <div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link">This Blog</a>
        <div class="navbar-dropdown">
          
          <a class="navbar-item" href="/tags/">All Tags</a>
          
          <a class="navbar-item" href="/posts/">All Posts</a>
          
        </div>
      </div>
      
      
      
      <a class="navbar-item" href="/about-me/">About Me</a>
      
      
    </div>

    <div class="navbar-end">
      

      
      <div class="navbar-item">
        <form id="cse-search-box-form-id" onsubmit="return executeQuery();" role="search">
          <div class="field has-addons">
            <div class="control is-expanded">
              <input id="cse-search-input-box-id" size=15 class="input" type="text" autocomplete="off"
                placeholder="&#xf1a0; Google search" style="font-family:Arial, FontAwesome">
            </div>

            <div class="control">
              <button type="submit" class="button is-black">
                <i class="fa fa-search"></i>
                </a>
              </button>
            </div>
          </div>
        </form>
      </div>
      
    </div>
  </div>
</nav><div class="columns is-centered">
        <div id="page-body" class="column is-7">

<div class="content-wrapper">
    
    
    <nav id="TableOfContents" class="table-of-contents">
        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#平行世界world">平行世界？World</a></li>
        <li><a href="#游戏中最重要的实体aactor">游戏中最重要的实体AActor</a></li>
        <li><a href="#apawn可操控的棋子">APawn（可操控的棋子)</a></li>
        <li><a href="#mvc模式显示数据算法">MVC模式（显示、数据、算法）</a></li>
        <li><a href="#继承和层次结构">继承和层次结构</a></li>
        <li><a href="#具体功能与模块">具体功能与模块</a></li>
        <li><a href="#agamemode-真游戏模式">AGameMode 真·游戏模式</a></li>
        <li><a href="#agamestate游戏状态">AgameState游戏状态</a></li>
        <li><a href="#question">Question？</a></li>
        <li><a href="#作业">作业</a>
          <ul>
            <li><a href="#创建摄像机">创建摄像机</a></li>
            <li><a href="#角色移动增强输入">角色移动增强输入</a></li>
            <li><a href="#角色动画">角色动画</a></li>
            <li><a href="#音效">音效</a></li>
            <li><a href="#特效">特效</a></li>
            <li><a href="#射线检测">射线检测</a></li>
            <li><a href="#更改第一人称视角">更改第一人称视角</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
    </nav>
    

    
    <div class="content blog">
        <h1>GameMode游戏模式</h1>

        <div id="infobar" class="level is-mobile">
            <div class="level-left">
                
                <div class="level-item">
                    <p class="subtitle info date">Nov 23, 2024
                    </p>
                </div>
                

                <div class="level-item">
                    <p class="subtitle info">
                        33 mins read
                    </p>
                </div>
            </div>
            <div class="level-right is-hidden-touch">
                <div class="tags">
                    
                    <a class="tag is-dark is-rounded" href="/tags/ue5">UE5</a>
                    
                </div>
            </div>
        </div>

        <div class="tags is-hidden-desktop">
            
            <a class="tag is-dark is-rounded" href="/tags/ue5">Ue5</a>
            
        </div>

        <div class="blog-text">
            

            <h2 id="平行世界world">平行世界？World</h2>
<p>UE中有三个世界</p>
<ul>
<li>游戏世界</li>
<li>编辑器世界</li>
<li>预览世界</li>
</ul>
<p>关卡蓝图-定义关卡规则</p>
<p><code>UGameInstance</code>  存在于游戏的整个生命周期中 不会随着地图切换 销毁 适合业务全局管理操作，Uengine  管理 GameInstance</p>
<hr>
<h2 id="游戏中最重要的实体aactor">游戏中最重要的实体AActor</h2>
<p>AActor 标志所有权的Owner指针，标志本地权限的Role枚举，作为网格同步的基础单位，根组件提供世界变化信息</p>
<p>Actor不只是3D中的表示，一些不可见对象也可以是Actor，如<em>AInfo</em>（派生类<em>Aworldsetting</em>，<em>AGameMode</em>，<em>AgameState</em>&hellip;）</p>
<p><strong>Actor在UE中就像是世界里的元素</strong></p>
<p><strong>Component 是 Actor 的组成部分，用于定义 Actor 的特性和行为</strong></p>
<ol>
<li><em>RootComponent</em>是Actor的核心组件，决定了Actor在场景中的位置、旋转和缩放</li>
<li><em>SceneComponent</em> 是一个基础组件，主要用于定义场景中对象的位置、旋转和缩放。它本身是一个抽象组件，不会直接渲染或显示。</li>
</ol>
<p><strong>Actor生命周期详解</strong></p>
<ul>
<li>
<p>生命周期1</p>
<p>actor分为</p>
<ul>
<li>静态的actor - 在关卡编辑器里直接放置的Actor</li>
<li>动态创建的actor（<em>spawnActor</em>） - 通过代码或蓝图在运行时动态生成的 Actor</li>
</ul>
</li>
<li>
<p>生命周期2
重要的生命周期函数</p>
<p>BeginPlay - 在Actor激活时调用 初始化</p>
<p>Tick - 每帧调用一次 处理逻辑</p>
<p>EndPlay - 在Actor即将销毁时调用 清理资源</p>
</li>
<li>
<p>生命周期3
GC完成收尾 注意有效性的判断</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (IsValid(MyActor)) {    <span style="color:#75715e">// Actor 有效 }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (MyActor <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>MyActor<span style="color:#f92672">-&gt;</span>IsPendingKill()) {    <span style="color:#75715e">// Actor 没有被标记为销毁 }
</span></span></span></code></pre></div><p><em>isPendingKill</em>是否已被标记为即将销毁，但尚未被垃圾回收系统（GC）完全移除。</p>
</li>
</ul>
<hr>
<h2 id="apawn可操控的棋子">APawn（可操控的棋子)</h2>
<p>最重要的特性：可以被controller控制 提供了输入、移动框架的支持</p>
<p>UE提供了一个默认的Pawn - <strong>DeflaultPawn</strong></p>
<p><strong>默认三件套</strong></p>
<ul>
<li><em><strong>DefaultPawnMovementComponent</strong></em></li>
<li><strong>sphericalCollisionComponent</strong></li>
<li><em><strong>StaticMeshComponent</strong></em></li>
</ul>
<p><em><strong>SpectatorPawn</strong></em></p>
<p>观众想观战但并不需要真正的表示他们 所以提供了<strong>USpectatorPawnMovement</strong>（不带重力漫游） 并关闭了StaticMesh的显示，碰撞设置到了Spectator通道</p>
<hr>
<p><strong>Character像是Pawn的加强特化版本</strong></p>
<p><strong>ACharacter</strong>人形角色（人形Pawn）</p>
<ul>
<li>
<p>近似仿真人形的胶囊体碰撞盒<em><strong>UCapsuleComponent</strong></em></p>
</li>
<li>
<p>骨骼模型<em><strong>USkeletalMeshComponent</strong></em></p>
</li>
<li>
<p>人物移动组件<em><strong>UCharacterMovementComponent</strong></em></p>
<ul>
<li>
<p>配合胶囊体完成了各种仿真移动计算Walking、Falling&hellip;</p>
</li>
<li>
<p>提供了Custom自定义移动模式供扩展</p>
</li>
<li>
<p>网络游戏移动同步架构 主控端预表现（网断了还能跑）服务器端校验 模拟端预测</p>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="mvc模式显示数据算法">MVC模式（显示、数据、算法）</h2>
<p><strong>显示（View）</strong>：</p>
<ul>
<li>由骨骼模型和动画组件（<code>USkeletalMeshComponent</code>）负责呈现角色的外观。</li>
<li>包括实时动画播放、物理效果展示等。</li>
</ul>
<p><strong>数据（Model）</strong>：</p>
<ul>
<li>角色的核心属性和状态（如速度、位置、旋转、是否跳跃）。</li>
<li>包括状态同步的网络消息结构和角色实例化的变量集合。</li>
</ul>
<p><strong>算法（Controller）</strong>：</p>
<ul>
<li>负责移动逻辑、动画状态切换、物理计算等行为。</li>
<li>包括人物移动组件的各种模式扩展与自定义处理逻辑。</li>
</ul>
<p>抽象这三个变化并归纳关系就是MVC模式</p>
<h2 id="继承和层次结构">继承和层次结构</h2>
<ol>
<li><strong>AController 继承自 AActor</strong>：
<ul>
<li>AController 是一个专门用于控制 APawn 行为的类。</li>
<li>它充当“提线木偶操控者”，通过指令驱动角色的移动、行为和其他逻辑。</li>
</ul>
</li>
<li><strong>UObject</strong>：
<ul>
<li>Unreal Engine 中最基础的类，所有对象的根基。</li>
<li><strong>功能</strong>：提供反射、序列化、垃圾回收（GC）和内存管理的机制。</li>
<li><strong>反射机制</strong>：支持运行时类型信息 (RTTI) 和蓝图扩展。</li>
<li><strong>序列化</strong>：用于保存和加载对象状态，广泛用于游戏保存、配置文件等。</li>
</ul>
</li>
<li><strong>UActorComponent</strong>：
<ul>
<li><strong>功能载体</strong>：AActor 的组件化架构。</li>
<li>逻辑代码或功能模块的载体（如健康系统、AI逻辑等）。</li>
<li><strong>嵌套能力</strong>：USceneComponent 提供世界变换（位置、旋转、缩放）以及嵌套结构支持。</li>
</ul>
</li>
<li><strong>AActor</strong>：
<ul>
<li>游戏对象的基础类，是组件的容器。</li>
<li><strong>功能</strong>：管理生命周期（Spawn/Destroy）、事件（Tick/Overlap）以及和世界的交互（物理、渲染等）。</li>
</ul>
</li>
<li><strong>APawn</strong>：
<ul>
<li>AActor 的子类，表示玩家或 AI 可控制的实体。</li>
<li>特点：
<ul>
<li>提供基本的物理表示（如碰撞体）。</li>
<li>支持玩家输入和基本移动能力。</li>
<li>可被 AController 绑定以实现复杂逻辑。</li>
</ul>
</li>
<li>当前常用于角色控制和 AI 代理。</li>
</ul>
</li>
</ol>
<hr>
<h2 id="具体功能与模块">具体功能与模块</h2>
<p><strong>APlayerController（提线木偶操控者）</strong>：</p>
<ul>
<li><strong>定义</strong>：玩家的控制代理，负责接收输入并将其转换为游戏行为。</li>
<li><strong>职责：</strong>
<ul>
<li>处理输入：将玩家输入映射到动作或功能。</li>
<li>控制 Pawn：通过控制接口驱动角色行为。</li>
<li>管理玩家视角：负责管理摄像机、HUD 和其他 UI 组件。</li>
</ul>
</li>
<li><strong>网络连接与所有权</strong>：
<ul>
<li>在多人游戏中，APlayerController 维护客户端和服务器之间的连接。</li>
<li>确保特定 APawn 的所有权归特定客户端（或服务器）所有。</li>
</ul>
</li>
</ul>
<p><strong>UInputComponent</strong>：</p>
<ul>
<li><strong>功能</strong>：用于绑定输入映射，将玩家输入转化为游戏事件。</li>
<li><strong>特点</strong>：
<ul>
<li>支持蓝图和 C++ 输入绑定。</li>
<li>使用输入映射表（Input Mapping Context）实现灵活的按键配置。</li>
</ul>
</li>
</ul>
<p><strong>APlayerCameraManager</strong>：</p>
<ul>
<li><strong>职责</strong>：
<ul>
<li>管理玩家的摄像机视角和摄像机效果。</li>
<li>支持视角切换（第一人称/第三人称）。</li>
<li>应用于动态摄像机逻辑，如抖动、跟随目标、动态缩放等。</li>
</ul>
</li>
</ul>
<p><strong><code>AHUD</code></strong>：</p>
<ul>
<li><strong>定义</strong>：传统的屏幕 UI 渲染类。</li>
<li><strong>特点</strong>：
<ul>
<li>早期用于绘制简单的屏幕元素（如血量、雷达等）。</li>
<li>被更灵活的 UMG 取代，但仍可用作低级别绘制需求。</li>
</ul>
</li>
<li><strong>区别</strong>：
<ul>
<li>HUD 是屏幕上的信息展示，通常绑定到玩家控制器。</li>
<li>UI 更复杂，可通过 UMG 实现交互式用户界面。</li>
</ul>
</li>
</ul>
<hr>
<h2 id="agamemode-真游戏模式">AGameMode 真·游戏模式</h2>
<p>玩家如何加入游戏 游戏特定行为（获胜）
所有GameMode均为 AGameMode的子类 AGameModeBase包含大量可覆盖的基础功能</p>
<hr>
<h2 id="agamestate游戏状态">AgameState游戏状态</h2>
<p>同mode基类子类</p>
<p>APlayerState玩家状态
playerState Character、Controller的职责区别</p>
<hr>
<h2 id="question">Question？</h2>
<blockquote>
<p>如果你来设计游戏，以下数据应该存放在哪里，是否需要同步给玩家？
玩家血量、玩家得分、队友位置、毒圈空头信息</p>
</blockquote>
<p><strong>1.玩家血量</strong>：</p>
<p>玩家血量是游戏的核心状态 需要在服务器存储并管理（防止作弊）</p>
<p>需要实时同步给本地的UI更新，但是不需要同步给敌人玩家，在团队作战中可以同步给队友。</p>
<p><strong>2.玩家得分：</strong></p>
<p>玩家得分是游戏结果的重要数据，需要服务器去存储，也需要同步给玩家的UI，但是客户端仅需要展示不需要存储。自己的得分需要同步，其他玩家可以定期的同步，如排行榜。</p>
<p><strong>3.队友位置：</strong></p>
<p>存储在服务器和客户端</p>
<p>需要同步给同队玩家，不能同步给敌人</p>
<p><strong>4.空投信息：</strong></p>
<p>毒圈和空投是全局信息，在服务器存储，客户端需要同步给所有玩家</p>
<p>需要同步给所有玩家，同步半径变化，毒圈缩小等，</p>
<hr>
<h2 id="作业">作业</h2>
<hr>
<p>创建一个空项目，新建C++Character类。</p>
<h3 id="创建摄像机">创建摄像机</h3>
<p><strong>PlayerCharaCharacter.h</strong>文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;GameFramework/SpringArmComponent.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UCameraComponent</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">protected</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	UPROPERTY(VisibleAnywhere)
</span></span><span style="display:flex;"><span>	USpringArmComponent<span style="color:#f92672">*</span> SpringArmComponent;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	UPROPERTY(VisibleAnywhere)
</span></span><span style="display:flex;"><span>	UCameraComponent<span style="color:#f92672">*</span> CameraComponent;
</span></span></code></pre></div><p><strong>PlayerCharaCharacter.cpp</strong>文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;Camera/CameraComponent.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>APlayerCharacter<span style="color:#f92672">::</span>APlayerCharacter()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	PrimaryActorTick.bCanEverTick <span style="color:#f92672">=</span> false;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">/* camera boom */</span> 
</span></span><span style="display:flex;"><span>	SpringArmComponent <span style="color:#f92672">=</span> CreateDefaultSubobject<span style="color:#f92672">&lt;</span>USpringArmComponent<span style="color:#f92672">&gt;</span>(<span style="color:#e6db74">&#34;SpringArmComponent&#34;</span>);
</span></span><span style="display:flex;"><span>	SpringArmComponent<span style="color:#f92672">-&gt;</span>SetupAttachment(RootComponent);
</span></span><span style="display:flex;"><span>	SpringArmComponent<span style="color:#f92672">-&gt;</span>TargetArmLength <span style="color:#f92672">=</span> <span style="color:#ae81ff">180.0f</span>;
</span></span><span style="display:flex;"><span>	SpringArmComponent<span style="color:#f92672">-&gt;</span>bUsePawnControlRotation <span style="color:#f92672">=</span> true;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">/* camera */</span>
</span></span><span style="display:flex;"><span>	CameraComponent <span style="color:#f92672">=</span> CreateDefaultSubobject<span style="color:#f92672">&lt;</span>UCameraComponent<span style="color:#f92672">&gt;</span>(<span style="color:#e6db74">&#34;CameraComponent&#34;</span>);
</span></span><span style="display:flex;"><span>	CameraComponent<span style="color:#f92672">-&gt;</span>SetupAttachment(SpringArmComponent, USpringArmComponent<span style="color:#f92672">::</span>SocketName);
</span></span><span style="display:flex;"><span>	CameraComponent<span style="color:#f92672">-&gt;</span>bUsePawnControlRotation <span style="color:#f92672">=</span> false;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>红色线是摄像机杆，之所以设置这个位置是为了在制作的过程中可以更方便观察角色，后面会改动至第一人称位置。</p>
<p>设置 Spring Arm（弹簧臂）组件，使其跟随玩家角色的旋转。当角色转动时，Spring Arm 会自动旋转，保持与角色的相对位置。</p>
<p>设置相机不随人物旋转，让视角保持固定位置。</p>
<p><img src="/images/UE/GameMode/Camera.png" alt="Camera"></p>
<hr>
<h3 id="角色移动增强输入">角色移动增强输入</h3>
<p>创建InputAction(IA_Look和IA_Move)和InputMappingContext，并设置如下图。</p>
<p><img src="/images/UE/GameMode/EnhancedInput.png" alt="EnhancedInput"></p>
<p><strong>PlayerCharaCharacter.h</strong>文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;InputActionValue.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">protected</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">void</span> Move(<span style="color:#66d9ef">const</span> FInputActionValue<span style="color:#f92672">&amp;</span> Value);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Look</span>(<span style="color:#66d9ef">const</span> FInputActionValue<span style="color:#f92672">&amp;</span> Value);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Enhanced Input&#34;</span>, meta <span style="color:#f92672">=</span> (AllowPrivateAccess <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;true&#34;</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UInputMappingContext</span><span style="color:#f92672">*</span> DefaultMappingContext;
</span></span><span style="display:flex;"><span>	UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Enhanced Input&#34;</span>, meta <span style="color:#f92672">=</span> (AllowPrivateAccess <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;true&#34;</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UInputAction</span><span style="color:#f92672">*</span> MoveAction;
</span></span><span style="display:flex;"><span>	UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Enhanced Input&#34;</span>, meta <span style="color:#f92672">=</span> (AllowPrivateAccess <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;true&#34;</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UInputAction</span><span style="color:#f92672">*</span> LookAction;
</span></span></code></pre></div><p><strong>PlayerCharaCharacter.cpp</strong>文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;EnhancedInputComponent.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;EnhancedInputSubsystems.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> APlayerCharacter<span style="color:#f92672">::</span>BeginPlay()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	Super<span style="color:#f92672">::</span>BeginPlay();
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">const</span> ULocalPlayer<span style="color:#f92672">*</span> Player <span style="color:#f92672">=</span> (GEngine <span style="color:#f92672">&amp;&amp;</span> GetWorld()) <span style="color:#f92672">?</span> GEngine<span style="color:#f92672">-&gt;</span>GetFirstGamePlayer(GetWorld()) <span style="color:#f92672">:</span> <span style="color:#66d9ef">nullptr</span>) 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>		UEnhancedInputLocalPlayerSubsystem<span style="color:#f92672">*</span> Subsystem <span style="color:#f92672">=</span> ULocalPlayer<span style="color:#f92672">::</span>GetSubsystem<span style="color:#f92672">&lt;</span>UEnhancedInputLocalPlayerSubsystem<span style="color:#f92672">&gt;</span>(Player);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (DefaultMappingContext) 
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>			Subsystem<span style="color:#f92672">-&gt;</span>AddMappingContext(DefaultMappingContext, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> APlayerCharacter<span style="color:#f92672">::</span>Move(<span style="color:#66d9ef">const</span> FInputActionValue<span style="color:#f92672">&amp;</span> Value)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	FVector2D MoveVector <span style="color:#f92672">=</span> Value.Get<span style="color:#f92672">&lt;</span>FVector2D<span style="color:#f92672">&gt;</span>();
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (Controller) 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// 获取控制器的旋转角度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#66d9ef">const</span> FRotator Rotation <span style="color:#f92672">=</span> Controller<span style="color:#f92672">-&gt;</span>GetControlRotation();
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// 提取Yaw 水平旋转角度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#66d9ef">const</span> FRotator <span style="color:#a6e22e">YawRotation</span>(<span style="color:#ae81ff">0</span>, Rotation.Yaw, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// 根据旋转角度计算前进方向
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#75715e">// FRotationMatrix(YawRotation) 会生成一个旋转矩阵，表示角色的旋转状态
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#75715e">// 通过 GetUnitAxis(EAxis::X)，我们从矩阵中获取角色在水平方向上的前进方向（即角色面朝的方向）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#66d9ef">const</span> FVector ForwardDirection <span style="color:#f92672">=</span> FRotationMatrix(YawRotation).GetUnitAxis(EAxis<span style="color:#f92672">::</span>X);
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// 根据旋转角度计算右侧方向
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#66d9ef">const</span> FVector RightDirection <span style="color:#f92672">=</span> FRotationMatrix(YawRotation).GetUnitAxis(EAxis<span style="color:#f92672">::</span>Y);
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// 将输入的 X 值映射到角色的前进方向
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		AddMovementInput(ForwardDirection, MoveVector.X);
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// 将输入的 Y 值映射到角色的右侧方向
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		AddMovementInput(RightDirection, MoveVector.Y);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> APlayerCharacter<span style="color:#f92672">::</span>Look(<span style="color:#66d9ef">const</span> FInputActionValue<span style="color:#f92672">&amp;</span> Value)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 角色看向 视角旋转
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	FVector2D LookVector <span style="color:#f92672">=</span> Value.Get<span style="color:#f92672">&lt;</span>FVector2D<span style="color:#f92672">&gt;</span>();
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (Controller) 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>		AddControllerYawInput(<span style="color:#f92672">-</span>LookVector.X);
</span></span><span style="display:flex;"><span>		AddControllerPitchInput(LookVector.Y);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> APlayerCharacter<span style="color:#f92672">::</span>SetupPlayerInputComponent(UInputComponent<span style="color:#f92672">*</span> PlayerInputComponent)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	Super<span style="color:#f92672">::</span>SetupPlayerInputComponent(PlayerInputComponent);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 确保输入组件是增强输入组件 绑定InputAction
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> (UEnhancedInputComponent<span style="color:#f92672">*</span> EnhancedInputComponent <span style="color:#f92672">=</span> CastChecked<span style="color:#f92672">&lt;</span>UEnhancedInputComponent<span style="color:#f92672">&gt;</span>(PlayerInputComponent)) {
</span></span><span style="display:flex;"><span>		EnhancedInputComponent<span style="color:#f92672">-&gt;</span>BindAction(LookAction, ETriggerEvent<span style="color:#f92672">::</span>Triggered, <span style="color:#66d9ef">this</span>, <span style="color:#f92672">&amp;</span>APlayerCharacter<span style="color:#f92672">::</span>Look);
</span></span><span style="display:flex;"><span>		EnhancedInputComponent<span style="color:#f92672">-&gt;</span>BindAction(MoveAction, ETriggerEvent<span style="color:#f92672">::</span>Triggered, <span style="color:#66d9ef">this</span>, <span style="color:#f92672">&amp;</span>APlayerCharacter<span style="color:#f92672">::</span>Move);
</span></span><span style="display:flex;"><span>		EnhancedInputComponent<span style="color:#f92672">-&gt;</span>BindAction(FireAction, ETriggerEvent<span style="color:#f92672">::</span>Triggered, <span style="color:#66d9ef">this</span>, <span style="color:#f92672">&amp;</span>APlayerCharacter<span style="color:#f92672">::</span>Fire);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<h3 id="角色动画">角色动画</h3>
<p>完成人物的移动后，需要加上动画效果，应该让人物在静止的时候是一个自然的状态，跑动的时候是跑动的动画。</p>
<p>新建一个C++ - AnimInstance类，并增加类的生命周期。</p>
<p>PlayerAnimInstance.h文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>UCLASS()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FPSCPP_API</span> UPlayerAnimInstance : <span style="color:#66d9ef">public</span> UAnimInstance
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	GENERATED_BODY()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">/* UAnimInstance类的虚函数 生命周期初始化 和 每一帧调用 */</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> NativeInitializeAnimation() <span style="color:#66d9ef">override</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">NativeUpdateAnimation</span>(<span style="color:#66d9ef">float</span> DeltaTime) <span style="color:#66d9ef">override</span>;
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	UPROPERTY(BlueprintReadOnly, Category <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Character&#34;</span>, meta <span style="color:#f92672">=</span> (AllowPrivateAccess <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;true&#34;</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">APlayerCharacter</span><span style="color:#f92672">*</span> PlayerCharacter;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	UPROPERTY(BlueprintReadOnly, Category <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Movement&#34;</span>, meta <span style="color:#f92672">=</span> (AllowPrivateAccess <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;true&#34;</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">float</span> Speed;
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>PlayerAnimInstance.cpp文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;PlayerCharacter.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;GameFramework/CharacterMovementComponent.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> UPlayerAnimInstance<span style="color:#f92672">::</span>NativeInitializeAnimation()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	Super<span style="color:#f92672">::</span>NativeInitializeAnimation();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	PlayerCharacter <span style="color:#f92672">=</span> Cast<span style="color:#f92672">&lt;</span>APlayerCharacter<span style="color:#f92672">&gt;</span>(TryGetPawnOwner());
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> UPlayerAnimInstance<span style="color:#f92672">::</span>NativeUpdateAnimation(<span style="color:#66d9ef">float</span> DeltaTime)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	Super<span style="color:#f92672">::</span>NativeUpdateAnimation(DeltaTime);
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (PlayerCharacter <span style="color:#f92672">==</span> <span style="color:#66d9ef">nullptr</span>) <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 得到角色的速度 设置z方向速度为0 因为不需要
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	FVector Velocity <span style="color:#f92672">=</span> PlayerCharacter<span style="color:#f92672">-&gt;</span>GetVelocity();
</span></span><span style="display:flex;"><span>	Velocity.Z <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.f</span>;
</span></span><span style="display:flex;"><span>	Speed <span style="color:#f92672">=</span> Velocity.Size();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>创建一个ABP_AnimInstance蓝图继承PlayerAnimInstance，Target Skeleton选择玩家的骨骼</p>
<p>创建BlendSpace1D用于平滑动画，选择玩家的骨骼。</p>
<p>在BlendSpace中设置水平轴名称为Speed最大值为350，Loop勾选上。在AssetBrowser中找到人物的走路动画和跑步动画拖动到下方窗口中。可以使用ctrl + shift + 鼠标单击看效果。</p>
<p><img src="/images/UE/GameMode/BlendSpace1D.png" alt="BlendSpace1D"></p>
<p>在蓝图中创建一个状态机（StateMachine 命名为IdleWalkRun）指向Output Pose。</p>
<p>双击进入到StateMachine中，新增一个状态IdleWalkRun，再次双击进去。</p>
<p><img src="/images/UE/GameMode/ABP_AnimInstance.png" alt="ABP_AnimInstance"></p>
<p>在角色蓝图中添加做好的AnimClass后，运行就可以看到角色有动画了，但是会发现鼠标移动转向的时候，角色的跑动方向也会发生变化。</p>
<p>我希望只有键盘会操纵角色的移动朝向，而不是鼠标。</p>
<p><img src="/images/UE/GameMode/ControllerRotation01.png" alt="ControllerRotation01"></p>
<p>使角色的朝向与其移动的方向一致。</p>
<p><img src="/images/UE/GameMode/Movement.png" alt="Movement"></p>
<hr>
<h3 id="音效">音效</h3>
<p>导入音效资源，选取喜欢的一些开枪射击音效，右键Creat Sound Cue，制作一个随机生成且混合起来的音效。</p>
<p>这样音效就会从两组音效中随机挑出两个音效合成。当音源和听者之间的距离发生变化时，<strong>Crossfade by Distance</strong> 会动态调整不同音轨（或音频配置）的混合比例。</p>
<p><img src="/images/UE/GameMode/SourceRandom.png" alt="SourceRandom"></p>
<p>在这之前我们要创建一个InputAction-IA——Fire用于射击，方法与之前人物移动同理。</p>
<p><strong>PlayerCharacter.h文件</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	UPROPERTY(EditAnywhere, BlueprintReadWrite, Category <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Combat&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">USoundCue</span><span style="color:#f92672">*</span> FireSoundEffect;
</span></span></code></pre></div><p><strong>PlayerCharacter.cpp文件</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;Sound/SoundCue.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> APlayerCharacter<span style="color:#f92672">::</span>Fire(<span style="color:#66d9ef">const</span> FInputActionValue<span style="color:#f92672">&amp;</span> Value)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">/* 开火声音 */</span> 
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (FireSoundEffect) 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>		UGameplayStatics<span style="color:#f92672">::</span>PlaySound2D(<span style="color:#66d9ef">this</span>, FireSoundEffect);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>编译后暴露给蓝图，在蓝图中添加制作的SoundCue</p>
<p><img src="/images/UE/GameMode/SoundCue.png" alt="SoundCue"></p>
<hr>
<h3 id="特效">特效</h3>
<p>首先要找到开火的位置，在gun_barrel下新建一个Socket，将枪口位置命名为GunBarrelSocket，确认枪口的坐标轴X方向指向枪口正对位置。</p>
<p><img src="/images/UE/GameMode/GunSocket.png" alt="e01d93502179c66d0006e93365bcde74_"></p>
<p><strong>PlayerCharacter.h文件</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	UPROPERTY(EditAnywhere, BlueprintReadWrite, Category <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Combat&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UParticleSystem</span><span style="color:#f92672">*</span> MuzzleFlash;
</span></span></code></pre></div><p><strong>PlayerCharacter.cpp文件 - Fire方法</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;Kismet/GameplayStatics.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;Particles/ParticleSystem.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;Engine/SkeletalMeshSocket.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">/* 获取开火枪口socket */</span> 
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">const</span> USkeletalMeshSocket<span style="color:#f92672">*</span> GunBarrelSocket <span style="color:#f92672">=</span> GetMesh()<span style="color:#f92672">-&gt;</span>GetSocketByName(<span style="color:#e6db74">&#34;GunBarrelSocket&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (GunBarrelSocket) 
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> FTransform SocketTransform <span style="color:#f92672">=</span> GunBarrelSocket<span style="color:#f92672">-&gt;</span>GetSocketTransform(GetMesh());
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/* 开火粒子特效 */</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (MuzzleFlash) {
</span></span><span style="display:flex;"><span>            UGameplayStatics<span style="color:#f92672">::</span>SpawnEmitterAtLocation(GetWorld(), MuzzleFlash, SocketTransform);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>在角色控制蓝图中添加特效</p>
<p><img src="/images/UE/GameMode/MuzzleFlash.png" alt="MuzzleFlash"></p>
<hr>
<h3 id="射线检测">射线检测</h3>
<p><strong>PlayerCharacter.cpp文件 - Fire方法</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;DrawDebugHelpers.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">/* LineTrace Hit */</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 存储碰撞结果
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	FHitResult HitRst;
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 开火位置为射线起始位置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">const</span> FVector Start{ SocketTransform.GetLocation() };
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 获取枪口的朝向 和 子弹发射的方向
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">const</span> FQuat StartRotation{ SocketTransform.GetRotation() };
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">const</span> FVector RotationAxis{ StartRotation.GetAxisX()};
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 确认射线的终点位置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">const</span> FVector End{ Start <span style="color:#f92672">+</span> RotationAxis <span style="color:#f92672">*</span> <span style="color:#ae81ff">500000.f</span> };
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 碰撞结果 射线起始位置 射线终点位置 碰撞通道射线检测
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	GetWorld()<span style="color:#f92672">-&gt;</span>LineTraceSingleByChannel(HitRst, Start, End, ECollisionChannel<span style="color:#f92672">::</span>ECC_Visibility);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 如果碰撞就发出一条描绘出来的射线
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> (HitRst.bBlockingHit)
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		DrawDebugLine(GetWorld(), Start, End, FColor<span style="color:#f92672">::</span>Red, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>		DrawDebugSphere(GetWorld(), HitRst.Location, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">10</span>, FColor<span style="color:#f92672">::</span>Blue, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>	}
</span></span></code></pre></div><p><img src="/images/UE/GameMode/FireLineTrace.gif" alt="FireLineTrace"></p>
<p>增加弹道轨迹和碰撞到物体的特效，隐藏掉绘制的射线。</p>
<p>在资源包中找到一个合适的弹道轨迹的Texture，新增一个Material材质，将Texture添加进去。</p>
<p>新增一个Cascade Particle System，新增Target、Source，对各项进行一些设置，如：Target最小输入输出、最大输入输出、Lifetime、Required中的Material、Kill on Deativate、Kill on Completed等。</p>
<p><img src="/images/UE/GameMode/WeaponTrail.png" alt="WeaponTrail"></p>
<p><img src="/images/UE/GameMode/ParticleSystem.png" alt="ParticleSystem"></p>
<p><strong>PlayerCharacter.cpp文件 - Fire方法</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>	<span style="color:#75715e">/* Impact Effect */</span> 
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (HitRst.bBlockingHit)
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (ImpactEffect) 
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			UGameplayStatics<span style="color:#f92672">::</span>SpawnEmitterAtLocation(GetWorld(), ImpactEffect, HitRst.Location);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">/* 子弹发射轨迹 */</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (BeamParticles) 
</span></span><span style="display:flex;"><span>	{
</span></span><span style="display:flex;"><span>		FVector BeamEndPoint{ FVector<span style="color:#f92672">::</span>ZeroVector };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (HitRst.bBlockingHit)
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			BeamEndPoint <span style="color:#f92672">=</span> HitRst.Location;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		UParticleSystemComponent<span style="color:#f92672">*</span> Beam <span style="color:#f92672">=</span> UGameplayStatics<span style="color:#f92672">::</span>SpawnEmitterAtLocation(GetWorld(), BeamParticles, SocketTransform);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (Beam) 
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			UE_LOG(LogTemp, Warning, TEXT(<span style="color:#e6db74">&#34;Beam-&gt;SetVectorParameter()&#34;</span>));
</span></span><span style="display:flex;"><span>			Beam<span style="color:#f92672">-&gt;</span>SetVectorParameter(FName(<span style="color:#e6db74">&#34;Target&#34;</span>), BeamEndPoint);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	}
</span></span></code></pre></div><hr>
<h3 id="更改第一人称视角">更改第一人称视角</h3>
<p>将角色蓝图中Pawn - Use Controller Rotation Yaw勾选</p>
<p>将摄像机调整到人物的头部位置，Mesh - Owner No See勾选</p>
<p>添加准星，新建HUD蓝图，在World Setting中设置HUD Class为新建的蓝图</p>
<p>准星位置为屏幕大小 / 2 - 准星大小 / 2</p>
<p><img src="/images/UE/GameMode/CrossHUD.png" alt="CrossHUD"></p>
<p>更改发射位置，起点为枪口位置，终点为准星的屏幕坐标转化成世界坐标位置延长点。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>    <span style="color:#75715e">// 获取枪口位置（起点）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    FVector Start <span style="color:#f92672">=</span> SocketTransform.GetLocation();
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 获取玩家控制器
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    APlayerController<span style="color:#f92672">*</span> PlayerController <span style="color:#f92672">=</span> GetWorld()<span style="color:#f92672">-&gt;</span>GetFirstPlayerController();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (PlayerController)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 获取屏幕中心准星位置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        FVector2D ScreenCenter <span style="color:#f92672">=</span> FVector2D(GEngine<span style="color:#f92672">-&gt;</span>GameViewport<span style="color:#f92672">-&gt;</span>Viewport<span style="color:#f92672">-&gt;</span>GetSizeXY()) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// StartWorld 是由 DeprojectScreenPositionToWorld 函数赋值的
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// 将屏幕空间中的位置（例如屏幕中心）转换为世界空间中的位置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        FVector StartWorld, Direction;
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 将屏幕中心位置转换为世界空间中的位置和方向
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (PlayerController<span style="color:#f92672">-&gt;</span>DeprojectScreenPositionToWorld(ScreenCenter.X, ScreenCenter.Y, StartWorld, Direction))
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            FVector End <span style="color:#f92672">=</span> StartWorld <span style="color:#f92672">+</span> Direction <span style="color:#f92672">*</span> <span style="color:#ae81ff">10000.0f</span>;
</span></span><span style="display:flex;"><span>            FHitResult HitRst;
</span></span><span style="display:flex;"><span>            GetWorld()<span style="color:#f92672">-&gt;</span>LineTraceSingleByChannel(HitRst, Start, End, ECollisionChannel<span style="color:#f92672">::</span>ECC_Visibility);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>创建Cube蓝图类和C++类CubeBeShot，加入缩小方法和销毁方法</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>	<span style="color:#75715e">// .h中
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	UFUNCTION(BlueprintCallable, Category <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Cube&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">void</span> Shrink();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	UFUNCTION(BlueprintCallable, Category <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Cube&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">void</span> DestoryCube();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	UPROPERTY(EditAnywhere, BlueprintReadWrite, Category <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Shooting&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">bool</span> bHasBeenShotOnce <span style="color:#f92672">=</span> false;
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// cpp中
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">void</span> ACubeBeShot<span style="color:#f92672">::</span>Shrink()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        FVector CurrentScale <span style="color:#f92672">=</span> GetActorScale3D();
</span></span><span style="display:flex;"><span>        SetActorScale3D(CurrentScale <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.5f</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> ACubeBeShot<span style="color:#f92672">::</span>DestoryCube()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        Destroy();
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>新建UserWidget蓝图类</p>
<p>简单添加一个TextBlock组件</p>
<p><img src="/images/UE/GameMode/Score.png" alt="Score"></p>
<p><strong>PlayerUserWidget.h文件</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span>UPROPERTY(EditAnywhere, meta <span style="color:#f92672">=</span> (BindWidget))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UTextBlock</span><span style="color:#f92672">*</span> TextScore;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 获取当前分数并返回文本
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>UFUNCTION(BlueprintCallable, Category <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;UI&#34;</span>)
</span></span><span style="display:flex;"><span>FText GetScoreText() <span style="color:#66d9ef">const</span>;
</span></span></code></pre></div><p><strong>PlayerUserWidget.cpp文件</strong></p>
<p>写下获取玩家分数显示在屏幕上</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>FText UPlayerUserWidget<span style="color:#f92672">::</span>GetScoreText() <span style="color:#66d9ef">const</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    APlayerCharacter<span style="color:#f92672">*</span> Player <span style="color:#f92672">=</span> Cast<span style="color:#f92672">&lt;</span>APlayerCharacter<span style="color:#f92672">&gt;</span>(UGameplayStatics<span style="color:#f92672">::</span>GetPlayerCharacter(GetWorld(), <span style="color:#ae81ff">0</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (Player)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> FText<span style="color:#f92672">::</span>AsNumber(Player<span style="color:#f92672">-&gt;</span>GetScore());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 如果没有获取到玩家角色，返回 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> FText<span style="color:#f92672">::</span>AsNumber(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>PlayerCharacter.h文件</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">protected</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">float</span> ShootCooldown <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.2f</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">float</span> LastShootTime;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    UPROPERTY(EditAnywhere, BlueprintReadWrite, Category <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Score&#34;</span>)
</span></span><span style="display:flex;"><span>    int32 AmountScore;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 指向 ScoreWidget 的类引用
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    UPROPERTY(EditAnywhere, BlueprintReadWrite, Category <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;UI&#34;</span>)
</span></span><span style="display:flex;"><span>    TSubclassOf<span style="color:#f92672">&lt;</span>UPlayerUserWidget<span style="color:#f92672">&gt;</span> UserWidgetClass;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 增加分数的方法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    UFUNCTION(BlueprintCallable, Category <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Score&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> AddScore(int32 Score);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 获取分数的 getter 方法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    UFUNCTION(BlueprintCallable, Category <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Score&#34;</span>)
</span></span><span style="display:flex;"><span>    int32 GetScore() <span style="color:#66d9ef">const</span>;  <span style="color:#75715e">// 返回分数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    UPlayerUserWidget<span style="color:#f92672">*</span> ScoreWidget;
</span></span></code></pre></div><p><strong>PlayerCharacter.cpp文件 - Fire方法</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">// 设置开火间隔 避免连续射击方块直接销毁
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">float</span> CurrentTime <span style="color:#f92672">=</span> GetWorld()<span style="color:#f92672">-&gt;</span>GetTimeSeconds();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(CurrentTime <span style="color:#f92672">-</span> LastShootTime <span style="color:#f92672">&lt;</span> ShootCooldown) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>LastShootTime <span style="color:#f92672">=</span> CurrentTime;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	AActor<span style="color:#f92672">*</span> HitActor <span style="color:#f92672">=</span> HitRst.GetActor();
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 如果射线碰撞到物体
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (HitRst.bBlockingHit <span style="color:#f92672">&amp;&amp;</span> HitActor<span style="color:#f92672">-&gt;</span>IsA(ACubeBeShot<span style="color:#f92672">::</span>StaticClass()))
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        ACubeBeShot<span style="color:#f92672">*</span> Cube <span style="color:#f92672">=</span> Cast<span style="color:#f92672">&lt;</span>ACubeBeShot<span style="color:#f92672">&gt;</span>(HitActor);
</span></span><span style="display:flex;"><span>        UE_LOG(LogTemp, Log, TEXT(<span style="color:#e6db74">&#34;Cube hit, bHasBeenShotOnce: %s&#34;</span>), Cube<span style="color:#f92672">-&gt;</span>bHasBeenShotOnce <span style="color:#f92672">?</span> TEXT(<span style="color:#e6db74">&#34;True&#34;</span>) <span style="color:#f92672">:</span> TEXT(<span style="color:#e6db74">&#34;False&#34;</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (Cube)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// 判断是否是第一次射击
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>Cube<span style="color:#f92672">-&gt;</span>bHasBeenShotOnce)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// 第一次射击：缩小
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                Cube<span style="color:#f92672">-&gt;</span>Shrink();
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// 标记被射击了一次
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                Cube<span style="color:#f92672">-&gt;</span>bHasBeenShotOnce <span style="color:#f92672">=</span> true;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// 第二次射击：销毁
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#75715e">// 随机生成 10 或 20 分
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                int32 RandomScore <span style="color:#f92672">=</span> FMath<span style="color:#f92672">::</span>RandBool() <span style="color:#f92672">?</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">20</span>;;
</span></span><span style="display:flex;"><span>                AddScore(RandomScore);
</span></span><span style="display:flex;"><span>                Cube<span style="color:#f92672">-&gt;</span>DestoryCube();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>在BeginPlay中绘制widget界面</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (UserWidgetClass)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    ScoreWidget <span style="color:#f92672">=</span> CreateWidget<span style="color:#f92672">&lt;</span>UPlayerUserWidget<span style="color:#f92672">&gt;</span>(GetWorld(), UserWidgetClass);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (ScoreWidget) {
</span></span><span style="display:flex;"><span>        ScoreWidget<span style="color:#f92672">-&gt;</span>AddToViewport();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>以及得分方法</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> APlayerCharacter<span style="color:#f92672">::</span>AddScore(int32 Score)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    AmountScore <span style="color:#f92672">+=</span> Score;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>int32 APlayerCharacter<span style="color:#f92672">::</span>GetScore() <span style="color:#66d9ef">const</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> AmountScore;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>最终效果图如下</p>
<p><img src="/images/UE/GameMode/CubeScore.gif" alt="CubeScore"></p>
<p>本次作业遗留下的改进点：</p>
<ol>
<li>
<p>在射击到Cube加分时，我使用的是随机生成一个分数，百分之五十的概率获取10分或者20分，如果更换成设置一些特殊的方块，比如其他颜色更大，就像游戏中的boss一样，每一个方块有自己的value，通过销毁然后获取value，效果会更好。</p>
</li>
<li>
<p>Cube如果开启了Simulate Physics，第一次射击看不到缩小的效果，两次射击后直接销毁。所以我没有增加物理效果，之后有待研究这个问题。</p>
</li>
<li>
<p>人物从第三人称改成第一人称视角后，弹道轨迹变得很丑。</p>
</li>
<li>
<p>第一人称视角应该看到手臂和枪的样子，有待改进。</p>
</li>
</ol>

        </div>
    </div>
</div><div id="social-media-share" class="has-text-centered">
	<p><i>Sharing is caring!</i></p>
	<br>
	
	<div class="share-buttons">
	    <a  href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fueleaning%2f2_gamemode%2f"
	        onclick="socialMediaPopUp(this.href, '', 500, 500); return false;"
	        title="Share on Facebook. Opens in a new window.">
	        <img src=/img/icons/45px/facebook.png>
	    </a>

	    <a  href="https://twitter.com/intent/tweet?text=GameMode%e6%b8%b8%e6%88%8f%e6%a8%a1%e5%bc%8f&url=http%3a%2f%2flocalhost%3a1313%2fposts%2fueleaning%2f2_gamemode%2f"
	        onclick="socialMediaPopUp(this.href, '', 500, 500); return false;"
	        title="Share on Twitter. Opens in a new window." >
	        <img src=/img/icons/45px/twitter.png>
	    </a>

		<a  href="http://www.reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fueleaning%2f2_gamemode%2f"
	        onclick="socialMediaPopUp(this.href, '', 900, 500); return false;"
	        title="Share on Reddit. Opens in a new window." >
	        <img src=/img/icons/45px/reddit.png>
	    </a>

	    <a  href="http://pinterest.com/pin/create/button/?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fueleaning%2f2_gamemode%2f"
	        onclick="socialMediaPopUp(this.href, '', 900, 500); return false;"
	        title="Share on Pinterest. Opens in a new window." >
	        <img src=/img/icons/45px/pinterest.png>
	    </a>

	    <a  href="http://www.tumblr.com/share/link?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fueleaning%2f2_gamemode%2f"
	        onclick="socialMediaPopUp(this.href, '', 900, 500); return false;"
	        title="Share on Tumblr. Opens in a new window." >
	        <img src=/img/icons/45px/tumblr.png>
	    </a>

		<a  href="https://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2flocalhost%3a1313%2fposts%2fueleaning%2f2_gamemode%2f
			&title=GameMode%e6%b8%b8%e6%88%8f%e6%a8%a1%e5%bc%8f&summary=%e5%b9%b3%e8%a1%8c%e4%b8%96%e7%95%8c%ef%bc%9fWorld%20UE%e4%b8%ad%e6%9c%89%e4%b8%89%e4%b8%aa%e4%b8%96%e7%95%8c%0a%e6%b8%b8%e6%88%8f%e4%b8%96%e7%95%8c%20%e7%bc%96%e8%be%91%e5%99%a8%e4%b8%96%e7%95%8c%20%e9%a2%84%e8%a7%88%e4%b8%96%e7%95%8c%20%e5%85%b3%e5%8d%a1%e8%93%9d%e5%9b%be-%e5%ae%9a%e4%b9%89%e5%85%b3%e5%8d%a1%e8%a7%84%e5%88%99%0aUGameInstance%20%e5%ad%98%e5%9c%a8%e4%ba%8e%e6%b8%b8%e6%88%8f%e7%9a%84%e6%95%b4%e4%b8%aa%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e4%b8%ad%20%e4%b8%8d%e4%bc%9a%e9%9a%8f%e7%9d%80%e5%9c%b0%e5%9b%be%e5%88%87%e6%8d%a2%20%e9%94%80%e6%af%81%20%e9%80%82%e5%90%88%e4%b8%9a%e5%8a%a1%e5%85%a8%e5%b1%80%e7%ae%a1%e7%90%86%e6%93%8d%e4%bd%9c%ef%bc%8cUengine%20%e7%ae%a1%e7%90%86%20GameInstance%0a%e6%b8%b8%e6%88%8f%e4%b8%ad%e6%9c%80%e9%87%8d%e8%a6%81%e7%9a%84%e5%ae%9e%e4%bd%93AActor%20AActor%20%e6%a0%87%e5%bf%97%e6%89%80%e6%9c%89%e6%9d%83%e7%9a%84Owner%e6%8c%87%e9%92%88%ef%bc%8c%e6%a0%87%e5%bf%97%e6%9c%ac%e5%9c%b0%e6%9d%83%e9%99%90%e7%9a%84Role%e6%9e%9a%e4%b8%be%ef%bc%8c%e4%bd%9c%e4%b8%ba%e7%bd%91%e6%a0%bc%e5%90%8c%e6%ad%a5%e7%9a%84%e5%9f%ba%e7%a1%80%e5%8d%95%e4%bd%8d%ef%bc%8c%e6%a0%b9%e7%bb%84%e4%bb%b6%e6%8f%90%e4%be%9b%e4%b8%96%e7%95%8c%e5%8f%98%e5%8c%96%e4%bf%a1%e6%81%af%0aActor%e4%b8%8d%e5%8f%aa%e6%98%af3D%e4%b8%ad%e7%9a%84%e8%a1%a8%e7%a4%ba%ef%bc%8c%e4%b8%80%e4%ba%9b%e4%b8%8d%e5%8f%af%e8%a7%81%e5%af%b9%e8%b1%a1%e4%b9%9f%e5%8f%af%e4%bb%a5%e6%98%afActor%ef%bc%8c%e5%a6%82AInfo%ef%bc%88%e6%b4%be%e7%94%9f%e7%b1%bbAworldsetting%ef%bc%8cAGameMode%ef%bc%8cAgameState%26hellip%3b%ef%bc%89%0aActor%e5%9c%a8UE%e4%b8%ad%e5%b0%b1%e5%83%8f%e6%98%af%e4%b8%96%e7%95%8c%e9%87%8c%e7%9a%84%e5%85%83%e7%b4%a0%0aComponent%20%e6%98%af%20Actor%20%e7%9a%84%e7%bb%84%e6%88%90%e9%83%a8%e5%88%86%ef%bc%8c%e7%94%a8%e4%ba%8e%e5%ae%9a%e4%b9%89%20Actor%20%e7%9a%84%e7%89%b9%e6%80%a7%e5%92%8c%e8%a1%8c%e4%b8%ba%0aRootComponent%e6%98%afActor%e7%9a%84%e6%a0%b8%e5%bf%83%e7%bb%84%e4%bb%b6%ef%bc%8c%e5%86%b3%e5%ae%9a%e4%ba%86Actor%e5%9c%a8%e5%9c%ba%e6%99%af%e4%b8%ad%e7%9a%84%e4%bd%8d%e7%bd%ae%e3%80%81%e6%97%8b%e8%bd%ac%e5%92%8c%e7%bc%a9%e6%94%be%20SceneComponent%20%e6%98%af%e4%b8%80%e4%b8%aa%e5%9f%ba%e7%a1%80%e7%bb%84%e4%bb%b6%ef%bc%8c%e4%b8%bb%e8%a6%81%e7%94%a8%e4%ba%8e%e5%ae%9a%e4%b9%89%e5%9c%ba%e6%99%af%e4%b8%ad%e5%af%b9%e8%b1%a1%e7%9a%84%e4%bd%8d%e7%bd%ae%e3%80%81%e6%97%8b%e8%bd%ac%e5%92%8c%e7%bc%a9%e6%94%be%e3%80%82%e5%ae%83%e6%9c%ac%e8%ba%ab%e6%98%af%e4%b8%80%e4%b8%aa%e6%8a%bd%e8%b1%a1%e7%bb%84%e4%bb%b6%ef%bc%8c%e4%b8%8d%e4%bc%9a%e7%9b%b4%e6%8e%a5%e6%b8%b2%e6%9f%93%e6%88%96%e6%98%be%e7%a4%ba%e3%80%82%20Actor%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e8%af%a6%e8%a7%a3%0a%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f1%0aactor%e5%88%86%e4%b8%ba%0a%e9%9d%99%e6%80%81%e7%9a%84actor%20-%20%e5%9c%a8%e5%85%b3%e5%8d%a1%e7%bc%96%e8%be%91%e5%99%a8%e9%87%8c%e7%9b%b4%e6%8e%a5%e6%94%be%e7%bd%ae%e7%9a%84Actor%20%e5%8a%a8%e6%80%81%e5%88%9b%e5%bb%ba%e7%9a%84actor%ef%bc%88spawnActor%ef%bc%89%20-%20%e9%80%9a%e8%bf%87%e4%bb%a3%e7%a0%81%e6%88%96%e8%93%9d%e5%9b%be%e5%9c%a8%e8%bf%90%e8%a1%8c%e6%97%b6%e5%8a%a8%e6%80%81%e7%94%9f%e6%88%90%e7%9a%84%20Actor%20%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f2%20%e9%87%8d%e8%a6%81%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e5%87%bd%e6%95%b0%0aBeginPlay%20-%20%e5%9c%a8Actor%e6%bf%80%e6%b4%bb%e6%97%b6%e8%b0%83%e7%94%a8%20%e5%88%9d%e5%a7%8b%e5%8c%96%0aTick%20-%20%e6%af%8f%e5%b8%a7%e8%b0%83%e7%94%a8%e4%b8%80%e6%ac%a1%20%e5%a4%84%e7%90%86%e9%80%bb%e8%be%91%0aEndPlay%20-%20%e5%9c%a8Actor%e5%8d%b3%e5%b0%86%e9%94%80%e6%af%81%e6%97%b6%e8%b0%83%e7%94%a8%20%e6%b8%85%e7%90%86%e8%b5%84%e6%ba%90%0a%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f3%20GC%e5%ae%8c%e6%88%90%e6%94%b6%e5%b0%be%20%e6%b3%a8%e6%84%8f%e6%9c%89%e6%95%88%e6%80%a7%e7%9a%84%e5%88%a4%e6%96%ad%0aif%20%28IsValid%28MyActor%29%29%20%7b%20%2f%2f%20Actor%20%e6%9c%89%e6%95%88%20%7d%20if%20%28MyActor%20%26amp%3b%26amp%3b%20%21MyActor-%26gt%3bIsPendingKill%28%29%29%20%7b%20%2f%2f%20Actor%20%e6%b2%a1%e6%9c%89%e8%a2%ab%e6%a0%87%e8%ae%b0%e4%b8%ba%e9%94%80%e6%af%81%20%7d%20isPendingKill%e6%98%af%e5%90%a6%e5%b7%b2%e8%a2%ab%e6%a0%87%e8%ae%b0%e4%b8%ba%e5%8d%b3%e5%b0%86%e9%94%80%e6%af%81%ef%bc%8c%e4%bd%86%e5%b0%9a%e6%9c%aa%e8%a2%ab%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6%e7%b3%bb%e7%bb%9f%ef%bc%88GC%ef%bc%89%e5%ae%8c%e5%85%a8%e7%a7%bb%e9%99%a4%e3%80%82&source=rafed123.github.io"
	        onclick="socialMediaPopUp(this.href, '', 900, 500); return false;"
	        title="Share on LinkedIn. Opens in a new window." >
	        <img src=/img/icons/45px/linkedin.png>
	    </a>

	    <a  href="mailto:?subject=GameMode%e6%b8%b8%e6%88%8f%e6%a8%a1%e5%bc%8f&amp;body=Check out this site http%3a%2f%2flocalhost%3a1313%2fposts%2fueleaning%2f2_gamemode%2f"
	        title="Share via Email. Opens in a new window." >
	        <img src=/img/icons/45px/mail.png>
	    </a>
	</div>
</div>


<br>
<div id="disqus_thread"></div>
<script type="text/javascript">
    (function () {
        
        
        if (window.location.hostname == "localhost")
            return;

        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        var disqus_shortname = 'disqus-code';
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


        </div>
    </div>
<script async src="https://cse.google.com/cse.js?cx=google-search-code"></script>
<gcse:searchresults-only></gcse:searchresults-only>


<footer class="footer has-background-dark">
    <div class="content has-text-centered has-text-white">
        <p>
            © 2024 GeeTeng.My
            <a class="has-text-light" href="https://github.com/GeeTeng" target="_blank">
            GitHub</a>. 

	    Email: 15143483@qq.com
        </p>
    </div>
</footer>

<div id="particles-js"></div>
    <script src="/js/particles.min.js"></script>
    <script>
        particlesJS.load('particles-js', '/js/particlesjs-config.json', function() {
            console.log('callback - particles.js config loaded');
        });
    </script>
</body>

</html>
